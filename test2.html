<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR tests</title>
</head>
<body class="bg-light">
    <div class="container py-5" id="main">
        <h3 class="mb-4" id="test_name">Методика диагностики мотивации избегания неудач (Т. Элерс)</h3>
        <p class="mb-4">В каждой строке выберите одно слово, которое наиболее точно Вас характеризует.</p>
        <div class="my-4">
            <a href="new.html" class="btn btn-danger">Назад</a>
        </div>

        <form id="testForm">

          <!-- ВОПРОСЫ -->
          <div id="questions"></div>

          <button type="button" class="btn btn-primary mt-4" onclick="calculateResult()">Показать результат</button>
        </form>
    </div>
</body>
</html>
<script src="bootstrap.bundle.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js?59"></script>
<script>
  let test_name = document.getElementById("test_name").textContent;
  let tg = window.Telegram.WebApp;
  tg.ready();
const questions = [
  ["Смелый", "бдительный", "предприимчивый"],
  ["Кроткий", "робкий", "упрямый"],
  ["Осторожный", "решительный", "пессимистичный"],
  ["Непостоянный", "бесцеремонный", "внимательный"],
  ["Неумный", "трусливый", "недумающий"],
  ["Ловкий", "бойкий", "предусмотрительный"],
  ["Хладнокровный", "колеблющийся", "удалой"],
  ["Стремительный", "легкомысленный", "боязливый"],
  ["Незадумывающийся", "жеманный", "непредусмотрительный"],
  ["Оптимистичный", "добросовестный", "чуткий"],
  ["Меланхоличный", "сомневающийся", "неустойчивый"],
  ["Трусливый", "небрежный", "взволнованный"],
  ["Опрометчивый", "тихий", "боязливый"],
  ["Внимательный", "неблагоразумный", "смелый"],
  ["Рассудительный", "быстрый", "мужественный"],
  ["Предприимчивый", "осторожный", "предусмотрительный"],
  ["Взволнованный", "рассеянный", "робкий"],
  ["Малодушный", "неосторожный", "бесцеремонный"],
  ["Пугливый", "нерешительный", "нервный"],
  ["Исполнительный", "преданный", "авантюрный"],
  ["Предусмотрительный", "бойкий", "отчаянный"],
  ["Укрощенный", "безразличный", "небрежный"],
  ["Осторожный", "беззаботный", "терпеливый"],
  ["Разумный", "заботливый", "храбрый"],
  ["Предвидящий", "неустрашимый", "добросовестный"],
  ["Поспешный", "пугливый", "беззаботный"],
  ["Рассеянный", "опрометчивый", "пессимистичный"],
  ["Осмотрительный", "рассудительный", "предприимчивый"],
  ["Тихий", "неорганизованный", "боязливый"],
  ["Оптимистичный", "бдительный", "беззаботный"]
];

/* Ключ (строка/столбец) */
const key = [
 "1/2","2/1","2/2","3/1","3/3","4/3","5/2","6/3","7/2","7/3","8/3","9/1","9/2","10/2",
 "11/1","11/2","12/1","12/3","13/2","13/3","14/1","15/1","16/2","16/3","17/3","18/1",
 "19/1","19/2","20/1","20/2","21/1","22/1","23/1","23/3","24/1","24/2","25/1","26/2",
 "27/3","28/1","28/2","29/1","29/3","30/2"
];

/* Создаем вопросы */
const wrap = document.getElementById("questions");

questions.forEach((row, i) => {
  const block = document.createElement("div");
  block.className = "card mb-3 p-3";

  let html = `<p><strong>${i+1}. Выберите одно слово:</strong></p>`;

  row.forEach((word, j) => {
    const id = `q${i+1}_${j+1}`;
    html += `
      <div class="form-check">
        <input class="form-check-input" type="radio" name="q${i+1}" id="${id}" value="${j+1}">
        <label class="form-check-label" for="${id}">
          ${word}
        </label>
      </div>`;
  });

  block.innerHTML = html;
  wrap.appendChild(block);
});

function calculateResult() {
  let score = 0;

  for (let i = 1; i <= 30; i++) {
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    if (!selected) {
      alert("Ответьте на ВСЕ вопросы!");
      return;
    }
    const choice = parseInt(selected.value);

    if (key.includes(`${i}/${choice}`)) score++;
  }

  // интерпретация
  let text = "";
  if (score >= 2 && score <= 10) text = "Низкая мотивация к защите";
  else if (score <= 16) text = "Средний уровень мотивации к избеганию неудач";
  else if (score <= 20) text = "Высокий уровень мотивации к избеганию неудач";
  else text = "Очень высокий уровень мотивации к избеганию неудач";

  // скрываем всё
  document.body.innerHTML = `
    <div class="container py-5">
      <div class="card p-4">
        <h3 class="mb-3">Ваш результат отправлен</h3>
      </div>
    </div>
  `;
  const userData = JSON.parse(sessionStorage.getItem("userData"));
    if (!userData) {
        alert("Сначала заполните форму");
        window.location.href = "who.html";
        return;
    }

    const testData = {
        test_name: test_name,
        scores: [text, score]
    };

    tg.sendData(JSON.stringify({
        user: userData,
        test: testData
    }));
}
</script>